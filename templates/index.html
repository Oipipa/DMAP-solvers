{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm mt-4">
  <div class="card-body">
    <form method="post" action="{{ url_for('solve') }}">

      <div class="mb-3">
        <label class="form-label">Select Problem</label>
        <select id="mode" name="mode" class="form-select">
          <option value="pca">PCA</option>
          <option value="lda">LDA</option>
          <option value="svd">SVD</option>
          <option value="kmeans">KMeans</option>
          <option value="agglomerative">Agglomerative</option>
          <option value="apiori">Apriori</option>
          <option value="iqr">IQR</option>
          <option value="purity">Purity</option>
          <option value="eclat">ECLAT</option>
          <option value="fpgrowth">FP-Growth</option>
          <option value="dbscan">DBSCAN</option>
          <option value="emd">EMD</option>
          <option value="cross_entropy">Cross-Entropy</option>
          <option value="normalization">Normalizations</option>
        </select>
      </div>

      <div class="input-group mb-3" id="pca-input">
        <span class="input-group-text">Data</span>
        <input type="text" name="data" class="form-control"
               placeholder="1,2;2,3;3,1">
      </div>

      <div class="input-group mb-3" id="lda-input">
        <span class="input-group-text">Class&nbsp;1</span>
        <input type="text" name="c1" class="form-control"
               placeholder="1,2;2,3">
        <span class="input-group-text">Class&nbsp;2</span>
        <input type="text" name="c2" class="form-control"
               placeholder="3,1;4,4">
      </div>

      <div class="input-group mb-3" id="svd-input">
        <span class="input-group-text">Matrix&nbsp;A</span>
        <input type="text" name="A" class="form-control"
               placeholder="2,2;-1,1;3,0">
      </div>

      <div class="input-group mb-3" id="kmeans-input">
        <span class="input-group-text">Points</span>
        <input type="text" name="points" class="form-control"
               placeholder="2,10;2,5;8,4;…">
      </div>
      <div class="input-group mb-3" id="kmeans-input-2">
        <span class="input-group-text">Centroids</span>
        <input type="text" name="centroids" class="form-control"
               placeholder="2,10;5,8">
        <span class="input-group-text">Iters</span>
        <input type="number" name="iters" class="form-control"
               min="1" value="2">
      </div>
      <div class="input-group mb-3" id="kmeans-input-3">
        <span class="input-group-text">Distance</span>
        <select name="distance" class="form-select">
          <option value="euclidean">Euclidean</option>
          <option value="manhattan">Manhattan</option>
          <option value="chebyshev">Chebyshev</option>
        </select>
      </div>

      <div class="input-group mb-3" id="agglomerative-input">
        <span class="input-group-text">Distance Matrix</span>
        <input type="text" name="matrix" class="form-control"
               placeholder="0,2,6,10;2,0,3,9;…">
      </div>

      <div class="input-group mb-3" id="apiori-input">
        <span class="input-group-text">Transactions</span>
        <input type="text" name="transactions" class="form-control"
               placeholder="A,B,C;B,C,D;…">
      </div>
      <div class="row mb-3" id="apiori-input-2">
        <div class="col">
          <label class="form-label">Min&nbsp;Sup</label>
          <input type="number" name="minsup" class="form-control"
                 min="1" value="3">
        </div>
        <div class="col">
          <label class="form-label">Min&nbsp;Conf</label>
          <input type="number" name="minconf" class="form-control"
                 min="0" max="1" step="0.01" value="0.7">
        </div>
      </div>

      <div class="input-group mb-3" id="iqr-input">
        <span class="input-group-text">Data</span>
        <input type="text" name="iqr_data" class="form-control"
               placeholder="60,65,70,72,…">
      </div>

      <div class="input-group mb-3" id="purity-input">
        <span class="input-group-text">True</span>
        <input type="text" name="true" class="form-control"
               placeholder="A,A,B,B,…">
        <span class="input-group-text">Pred</span>
        <input type="text" name="pred" class="form-control"
               placeholder="C1,C1,C2,C1,…">
      </div>

      <div class="input-group mb-3" id="eclat-input">
        <span class="input-group-text">Boolean matrix CSV</span>
        <textarea name="eclat_matrix" class="form-control" rows="3"
          placeholder=",Bread,Butter,…;T1,1,1,…;…"></textarea>
      </div>
      <div class="row mb-3" id="eclat-input-2">
        <div class="col">
          <label class="form-label">Min&nbsp;Sup</label>
          <input type="number" name="eclat_minsup" class="form-control"
                 min="1" value="2">
        </div>
        <div class="col">
          <label class="form-label">Max&nbsp;k</label>
          <input type="number" name="eclat_maxk" class="form-control"
                 placeholder="optional">
        </div>
      </div>

      <div class="input-group mb-3" id="fpgrowth-input">
        <span class="input-group-text">Transactions</span>
        <input type="text" name="fpgrowth_transactions" class="form-control"
               placeholder="T1:A,B,C;T2:B,C,D;…">
      </div>
      <div class="input-group mb-3" id="fpgrowth-input-2">
        <span class="input-group-text">Min&nbsp;Sup</span>
        <input type="number" name="fpgrowth_minsup" class="form-control"
               min="1" value="3">
      </div>

      <div class="input-group mb-3" id="dbscan-input">
        <span class="input-group-text">Points</span>
        <input type="text" name="dbs_points" class="form-control"
               placeholder="1,2;2,3;3,1">
        <span class="input-group-text">ε</span>
        <input type="number" name="dbs_eps" class="form-control"
               step="0.1" value="1.0">
        <span class="input-group-text">MinPts</span>
        <input type="number" name="dbs_minpts" class="form-control"
               min="1" value="2">
      </div>

      <div class="input-group mb-3" id="emd-input">
        <span class="input-group-text">P</span>
        <input type="text" name="emd_p" class="form-control"
               placeholder="1,0,0">
        <span class="input-group-text">Q</span>
        <input type="text" name="emd_q" class="form-control"
               placeholder="0,0,1">
      </div>

      <div class="input-group mb-3" id="cross_entropy-input">
        <span class="input-group-text">P</span>
        <input type="text" name="ce_p" class="form-control"
               placeholder="0.2,0.5,0.3">
        <span class="input-group-text">Q</span>
        <input type="text" name="ce_q" class="form-control"
               placeholder="0.1,0.3,0.6">
      </div>

      <!-- Normalization ----------------------------------------------------->
      <div class="input-group mb-3" id="normalization-input">
        <span class="input-group-text">Data</span>
        <input type="text" name="norm_data" class="form-control"
               placeholder="10,20,15,30,25">
        <span class="input-group-text">Method</span>
        <select name="norm_method" class="form-select">
          <option value="minmax">Min–Max</option>
          <option value="zscore">Z-Score</option>
          <option value="mean">Mean Norm</option>
          <option value="decimal">Decimal Scaling</option>
        </select>
      </div>

      <button type="submit" class="btn btn-primary">Solve</button>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const m      = document.getElementById('mode');
  const groups = document.querySelectorAll('.input-group');
  const rows2  = document.querySelectorAll(
      '#kmeans-input-2,#kmeans-input-3,' +
      '#apiori-input-2,#eclat-input-2,'  +
      '#fpgrowth-input-2'
  );

  function updateVisibility() {
    // show only the block whose id matches mode + "-input"
    groups.forEach(g => {
      g.style.display = (g.id === m.value + '-input') ? 'flex' : 'none';
    });

    // extra sub-blocks for some solvers
    const map = {
      kmeans:  ['kmeans-input-2', 'kmeans-input-3'],
      apriori: ['apiori-input-2'],
      eclat:   ['eclat-input-2'],
      fpgrowth:['fpgrowth-input-2']
    };
    rows2.forEach(r => {
      r.style.display = map[m.value]?.includes(r.id) ? 'flex' : 'none';
    });
  }

  m.addEventListener('change', updateVisibility);
  updateVisibility();               // initial call
});
</script>
{% endblock %}
